# ä¸‰æŒ‡æœºå™¨äººå‚è€ƒæ–‡æ¡£

> å½“å‰è¿˜åœ¨å­¦ä¹ ä¸‡å¼ºæ‰€å®Œæˆçš„å·¥ä½œï¼Œé¡¹ç›®å®Œå–„ä¸­ã€‚ã€‚ã€‚

## æœºå™¨äººç¡¬ä»¶å®‰è£…

> æ•™ç¨‹ [GitHub - open_robot_actuator_hardware](https://github.com/open-dynamic-robot-initiative/open_robot_actuator_hardware)ï¼Œè®ºæ–‡ [TriFinger: An Open-Source Robot for Learning Dexterity](https://arxiv.org/abs/2008.03596)

![æœºå™¨äºº](./assets/figures/æœºå™¨äºº.png)

æ¯ä¸ª1ä¸ªå¼€å‘æ¿ `F28069M` å¯ä»¥æœ€å¤šæ§åˆ¶2ä¸ªé©±åŠ¨æ¿ `DRV8305EVM`ï¼Œæ¯ä¸ªé©±åŠ¨æ¿æ§åˆ¶ä¸€ä¸ªç”µæœº `MN4004 300KV`ï¼Œæ¯ä¸ªç”µæœºè¿˜éœ€è¦ä¸€ä¸ªç¼–ç å™¨ `AEDT-981x` é€šè¿‡æ£€æµ‹ä¸€ä¸ªè¿æ¥ç”µæœºçš„è½¬ç‰‡æ¥è·å–å½“å‰æ‰‹è‡‚ä½ç½®å’Œé€Ÿåº¦ä¿¡æ¯ï¼Œæ¯ä¸ªæ‰‹è‡‚ä¸‰ä¸ªè‡ªç”±åº¦ï¼Œæ¯ä¸ªè‡ªç”±åº¦éœ€è¦ä¸€ä¸ªç”µæœºæ§åˆ¶ï¼Œåˆ™éœ€è¦9ä¸ªç”µæœºã€‚

æŒ‰ç…§æ‰‹è‡‚å°†æ•´ä¸ªæœºå™¨åˆ†ä¸º3å¤§å—ï¼Œæ¯ä¸€å—éœ€è¦3ä¸ªç”µæœºï¼Œå› æ­¤éœ€è¦2ä¸ªå¼€å‘æ¿å’Œ1ä¸ªé©±åŠ¨æ¿ï¼Œæ‰€ä»¥æ€»å…±éœ€è¦ `2*3` ä¸ªå¼€å‘æ¿ï¼Œ9ä¸ªé©±åŠ¨æ¿ï¼Œ9ä¸ªç”µæœºã€‚

### ç”µæœºå¤„ç†

[ç”µæœºæ”¹è£…æ•™ç¨‹](https://github.com/open-dynamic-robot-initiative/open_robot_actuator_hardware/blob/master/mechanics/actuator_module_v1/details/details_motor_preparation.md#details-motor-preparation)ï¼šå…ˆå°†è½¬å­ï¼ˆRotorï¼‰å’Œå®šå­ï¼ˆStatorï¼‰æ‹†åˆ†å‡ºæ¥ï¼Œåˆ†åˆ«è¿›è¡Œå¤„ç†

- è½¬å­ï¼šå°†è½¬å­ä¸­é—´çš„å­”å¾„å¢å¤§ï¼ŒæŠŠ[åŠ é•¿çš„å®šåˆ¶ç”µæœºè½´](https://github.com/open-dynamic-robot-initiative/open_robot_actuator_hardware/blob/master/mechanics/actuator_module_v1/drawings/motor_shaft.PDF)æ’è¿›å»ã€‚s
- å®šå­ï¼šå°†å®šå­åŸæœ¬çš„ä¸‰ç›¸çº¿æ‹†ä¸‹æ¥ï¼Œç„Šæ¥åˆ°æ›´é•¿çš„ä¸‰ç›¸çº¿ä¸Šã€‚

æ”¹è£…äº†ç”µæœºè¿˜éœ€è¦åˆ¶ä½œå¯¹åº”çš„æ‰§è¡Œå™¨æ¨¡å—ï¼Œéœ€è¦ä½¿ç”¨ä¸¤ä¸ªåŠå¾„å¤§å°1:3çš„å‡é€Ÿé½¿è½®ï¼Œæ€»å…±è¾¾åˆ°1:9çš„å‡é€Ÿæ•ˆæœï¼Œä»è€Œèƒ½åŠ å¼ºåŠ›çŸ©è¾“å‡ºæ•ˆæœï¼Œæ­¤éƒ¨åˆ†é€æ­¥å®‰è£…æ•™ç¨‹è¯·è§ [Step-by-Step Instructions](https://github.com/open-dynamic-robot-initiative/open_robot_actuator_hardware/?tab=readme-ov-file#step-by-step-instructions)ã€‚

### æ¥çº¿

- æ¯ä¸ªç”µæœºéœ€è¦ä¸‰ç›¸ç”µé€šç”µï¼ˆ3æ ¹ï¼‰è¿æ¥åˆ°é©±åŠ¨æ¿ä¸Š
- æ¯ä¸ªé©±åŠ¨æ¿éœ€è¦ç”µæºçº¿é€šç”µï¼ˆ2æ ¹ï¼‰è¿æ¥å¤–ç½®ç”µæºï¼ˆç”µå‹è‡³å°‘ä¸º23Vï¼Œå……ç”µèƒ½åˆ°25Vï¼‰
- æ¯ä¸ªç¼–ç å™¨éœ€è¦ 5v çº¿å’Œæ¥åœ°çº¿+3æ ¹é€šé“çº¿ï¼ˆ5æ ¹ï¼‰è¿æ¥åˆ°å¼€å‘æ¿ä¸Š
- æ¯ä¸ªå¼€å‘æ¿éœ€è¦è¿æ¥CANé€šè®¯çº¿ï¼ˆ2æ ¹ï¼‰è¿æ¥åˆ°GCANè®¾å¤‡ï¼ˆäº¤æ¢æœºï¼‰ä¸Š

ç»¼ä¸Šï¼Œä¸€ä¸ªæ‰‹è‡‚çš„æ•°å­—æ§åˆ¶ç»„ä»¶åŒ…å« `3*3+2*3+5*3+2*2=34` æ ¹çº¿ï¼Œæ€»å…±éœ€è¦ `34*3=102` æ ¹çº¿ã€‚

## è½¯ä»¶

### å¼€å‘æ¿ç¨‹åºçƒ§å½•

## ç›¸æœº

æˆ‘ä»¬éœ€è¦ä¸¤ä¸ªï¼ˆå¯ä»¥æ›´å¤šï¼‰æ‘„åƒå¤´ `D435`ï¼ˆ`D435i` ä¹Ÿä¸€æ ·ï¼‰ å¯¹æ–¹å—ä½ç½®è¿›è¡Œè¯†åˆ«ï¼Œéœ€è¦å¯¹ç›¸æœºçš„å…§å¤–å‚è¿›è¡Œæ ‡å®šï¼Œè¿™äº›å‚æ•°æ ‡å®šéœ€è¦åœ¨ Linux ç³»ç»Ÿä¸‹è¿›è¡Œã€‚

### ROS2+RealSenseè·å–å†…å‚çŸ©é˜µï¼ˆå¯è·³è¿‡ï¼‰

[[æ•™ç¨‹]å®‰è£…realsense-ros](https://github.com/IntelRealSense/realsense-ros?tab=readme-ov-file#installation-on-ubuntu)ï¼Œrealsense-SDK æ˜¯ç”¨äºç›¸æœºå¯è§†åŒ–ä¸è·å–ç›¸æœºå†…å‚ï¼Œéœ€è¦ä¾èµ– ROS ä¸ç›¸æœºè¿›è¡Œé€šè®¯ï¼Œæˆ‘ä»¬æ ¹æ®ä¸Šè¿°æ•™ç¨‹è¿›è¡Œå®‰è£…ï¼š

1. **ROS2 å®‰è£…**ï¼šæˆ‘ä»¬å®‰è£…çš„æ˜¯ [ROS2 Humble](https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html)ï¼ˆè¿™ä¸ªç›¸æ¯” [ROS2 Iron](https://docs.ros.org/en/iron/Installation/Ubuntu-Install-Debians.html) æœ‰æ›´é•¿çš„ç»´æŠ¤æ—¶é—´ï¼‰
   1. **å®‰è£…**ï¼šç›´æ¥è¿›å…¥[å®˜æ–¹çš„å®‰è£…æ•™ç¨‹](https://docs.ros.org/en/humble/Installation/Ubuntu-Install-Debians.html#install-ros-2-packages)ä¸­ï¼Œé¡ºæ¬¡æ‰§è¡Œä¸‹æ¥å³å¯ï¼Œæ³¨æ„å®‰è£… `sudo apt install ros-humble-desktop` æ—¶å€™å¯èƒ½ä¼šçˆ†ç‰ˆæœ¬è¿‡é«˜çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå®‰è£… `sudo apt install aptitude` ç”¨äºåŒ…ç‰ˆæœ¬é™çº§ï¼Œå†ä½¿ç”¨ `sudo aptitude install ros-humble-desktop` è¿›è¡Œå®‰è£…ï¼ˆå¦‚æ­¤å®‰è£…éœ€è¦è¦å¯¹å®‰è£…ç­–ç•¥è¿›è¡Œé€‰æ‹©ï¼Œå½“çœ‹åˆ° `ros-humble-desktop` åœ¨ `uninstall` åˆ—è¡¨ä¸­æ—¶ï¼ŒæŒ‰ `n` å›è½¦ï¼Œè®©å…¶ç»§ç»­ç»™å‡ºæ–°çš„å®‰è£…ç­–ç•¥ï¼Œç›´åˆ° `ros-humble-desktop` ä¸å† `uninstall` ä¸­æ—¶ï¼ŒæŒ‰ `y` å›è½¦ï¼‰
   2. **ç¯å¢ƒå˜é‡**ï¼šå®‰è£…å®Œæˆ `ros-humble-desktop` åè¿˜éœ€è¦æ‰§è¡Œ `source /opt/ros/humble/setup.bash` å¯¹ç¯å¢ƒå˜é‡è¿›è¡Œæ›´æ–°ï¼Œç”±äºæˆ‘ç”¨çš„æ˜¯ `zsh`ï¼Œæ‰€ä»¥æ‰§è¡Œ `source /opt/ros/humble/setup.zsh` å³å¯ã€‚å¦‚æœä¸æƒ³æ¯æ¬¡éƒ½ `source` ä¸€æ¬¡å¯ä»¥ç›´æ¥å°† `source source /opt/ros/humble/setup.zsh` åŠ å…¥åˆ° `~/.zshrc` ä¸­ï¼ˆå¦‚æœæ˜¯ bash åˆ™åŠ å…¥åˆ° `.bashrc` ä¸­ï¼‰
   3. **ç®€å•æµ‹è¯•**ï¼šåœ¨ä¸€ä¸ªç»ˆç«¯ä¸­æ‰“å¼€ä¸€ä¸ªå°ä¹Œé¾Ÿæµ‹è¯•å™¨ `ros2 run turtlesim turtlesim_node`ï¼Œå†å¼€ä¸€ä¸ªç»ˆç«¯æ‰“å¼€ `ros2 run turtlesim turtle_teleop_key` æ§åˆ¶å™¨ï¼ˆèŠ‚ç‚¹ï¼‰ï¼Œå¯¹é‡Œé¢æŒ‰ä¸Šä¸‹å·¦å³å³å¯å¯¹å°ä¹Œé¾Ÿè¿›è¡Œæ§åˆ¶äº†ï¼
2. **å®‰è£… RealSenseâ„¢ SDK 2.0**ï¼š[å®‰è£…æ•™ç¨‹](https://github.com/IntelRealSense/librealsense/blob/master/doc/distribution_linux.md#installing-the-packages)ï¼Œåªéœ€å®‰è£… `librealsense2-dkms` å’Œ `librealsense2-utils` å³å¯ï¼Œè¾“å…¥å‘½ä»¤ `realsense-viewer` å³å¯æ‰“å¼€ç›¸æœºæ˜¾ç¤ºçš„å¯è§†åŒ–ç•Œé¢ï¼ˆè¿æ¥ç›¸æœºå³å¯çœ‹åˆ°ç”»é¢ï¼ŒåŒ…å«å›¾åƒåŠæ·±åº¦å›¾ï¼‰
3. **å‘ ROS2 ä¸­å®‰è£… RealSense wrapper**ï¼šæˆ‘çš„æ˜¯ `humble` ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç›´æ¥å®‰è£… `sudo apt install ros-humble-realsense2-*` å³å¯ã€‚

å‚è€ƒ[ubuntu20.08ä¸‹è·å–realsenseå†…å‚ï¼ˆä½¿ç”¨rosåŠŸèƒ½åŒ…ï¼‰](https://blog.csdn.net/weixin_42691563/article/details/126818521)ï¼šæˆ‘ä»¬éœ€è¦ç”¨ type-c 3.0 ï¼ˆå¿…é¡» 3.0 å“ˆï¼‰çš„ USB çº¿è¿æ¥æ‘„åƒå¤´å’Œç”µè„‘ï¼Œè¿è¡Œå‘½ä»¤ `ros2 run realsense2_camera realsense2_camera_node` å³å¯å°†å½“å‰ç›¸æœºåŠ å…¥ ROS ä¸­çš„èŠ‚ç‚¹ï¼Œç„¶åé€šè¿‡ `ros2 topic list` æŸ¥çœ‹å½“å‰èŠ‚ç‚¹ç›¸å…³çš„è¯é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¿™äº›è¯é¢˜ï¼Œå†å¼€ä¸ªæ–°çš„ç»ˆç«¯æ‰§è¡Œ `ros2 topic echo /camera/color/camera_info` è·å–åˆ°å½“å‰ç›¸æœºç›¸å…³å‚æ•°ï¼Œå…¶ä¸­å†…å‚çŸ©é˜µä¸º `k` åé¢çš„ 9 ä¸ªå‚æ•°ï¼Œåˆ†åˆ«ä¸º $3\times 3$ çš„å†…å‚çŸ©é˜µæ¨ªå‘å±•å¼€çš„ç»“æœã€‚

![ROS2æ˜¾ç¤ºè¯é¢˜åŠæŸ¥çœ‹è¯é¢˜å†…å®¹](./assets/figures/ROS2æ˜¾ç¤ºè¯é¢˜åŠæŸ¥çœ‹è¯é¢˜å†…å®¹.png)

ä¾‹å¦‚ä¸Šå›¾ä¸­ï¼Œæˆ‘çš„ç›¸æœºå†…å‚çŸ©é˜µå°±æ˜¯ `k=[[616.3648681640625,0.0,316.91259765625],[0.0,616.5704345703125,243.251953125],[0.0,0.0,1.0]]`ï¼š
$$
K=\begin{bmatrix}
616.36&0&316.91\\
0&616.57&243.25\\
0&0&1
\end{bmatrix}
$$

### [Docker] ROS1+RealSense+Kalibrè·å–å†…å‚åŠç•¸å˜çŸ©é˜µ

æˆ‘ä»¬éœ€è¦ä½¿ç”¨ Kalibr å·¥å…·ç®±è·å–ç›¸æœºçš„ç•¸å˜çŸ©é˜µï¼Œå®‰è£… Kalibr æ–¹æ³•å¦‚ä¸‹ï¼Œå‚è€ƒ[å®˜æ–¹æ•™ç¨‹](https://github.com/ethz-asl/kalibr/wiki/installation)ï¼Œä¸¤ç§æ–¹æ³•æˆ‘éƒ½è¿›è¡Œäº†å°è¯•ï¼Œé¦–å…ˆå°è¯•çš„å°±æ˜¯ç›´æ¥ç¼–è¯‘å®‰è£…ï¼Œå†æ˜¯Dockerå®‰è£…ã€‚

**ç›´æ¥ç¼–è¯‘å®‰è£… Kalibrï¼ˆå¤±è´¥ğŸ˜¢ï¼‰**ï¼šä½†æ˜¯æœ€åå‘ç°ç³»ç»Ÿè‡ªå¸¦çš„ Python ç‰ˆæœ¬ä¸º 3.10ï¼Œç„¶è€Œç¼–è¯‘æ—¶å€™å¿…é¡»è¦ç”¨åˆ°ä¸€ä¸ªå« Boost çš„å·¥å…·åŒ…å¿…é¡»è¦ Python 3.8 ç‰ˆæœ¬ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶é™çº§ï¼Œæœ€ç»ˆä½†å®‰è£… ROS1 åˆä¼šè‡ªåŠ¨å®‰è£…æ–°ç‰ˆæœ¬ï¼Œå› æ­¤æ²¡æœ‰è§£å†³åŠæ³•ï¼ˆå¤±è´¥è¿‡ç¨‹å¦‚ä¸‹ï¼‰ï¼š

1. å®‰è£… ROS1ï¼šå‚è€ƒ[BiliBili - Ubuntu 22.04 apt å®‰è£… ros1 ros Noetic Ninjemys](https://www.bilibili.com/read/cv30135783/)
2. å®‰è£… Python ç›¸å…³åŒ…ï¼šæˆ‘ç”¨ `mamba`ï¼ˆ`conda` ä¹Ÿä¸€æ ·ï¼‰åˆ›å»ºä¸€ä¸ªæ–°çš„ `python 3.8.*` çš„ç¯å¢ƒï¼Œä½¿ç”¨ `pip` å®‰è£…è¿™äº›ä¾èµ–åŒ…ï¼š`pip install catkin-tools osrf-pycommon scipy matplotlib wxpython pyx `

3. é‡åˆ°æŠ¥é”™
   - `fatal error: libv4l2.h: No such file or directory`ï¼š`sudo apt install libv4l-dev`
   - `fatal error: pyconfig.h: No such file or directory`ï¼Œéœ€è¦æ‰¾åˆ° `pyconfig.h` æ–‡ä»¶ä½ç½®ï¼Œä½¿ç”¨ `find /usr/include -name pyconfig.h` äº§çœ‹è¿”å›ç»“æœï¼Œä¾‹å¦‚æˆ‘è¿”å›çš„æ˜¯ `/usr/include/python3.10/pyconfig.h` è¯´æ˜è¯¥æ–‡ä»¶åœ¨ `/usr/include/python3.10/` æ–‡ä»¶å¤¹ä¸‹ï¼Œæ ¹æ® [overflowçš„è§£ç­”](https://stackoverflow.com/a/22674820) åŠ å…¥ç¯å¢ƒå˜é‡ï¼š`export CPLUS_INCLUDE_PATH="$CPLUS_INCLUDE_PATH:/usr/include/python3.10/"` 
   - `fatal error: boost/detail/endian.hpp: No such file or directory`ï¼šå’Œä¸Šé¢çš„é—®é¢˜ç±»ä¼¼ï¼Œåªéœ€è¦æ‰¾åˆ° `boost/detail/endian.hpp` æ‰€åœ¨çš„è·¯å¾„ï¼Œä¾‹å¦‚æˆ‘çš„å°±åœ¨ `/usr/include/` ä¸‹ï¼ŒåŠ å…¥åˆ° C++ é“¾æ¥åº“ä¸­å³å¯`export CPLUS_INCLUDE_PATH="$CPLUS_INCLUDE_PATH:/usr/include/"`ï¼Œ**æ³¨æ„**ï¼šæˆ‘çš„ `/detail` ç›®å½•ä¸‹æ²¡æœ‰ `endian.hpp`ï¼Œæ‰€ä»¥æˆ‘åˆåšäº†ä¸ªè½¯é“¾æ¥æ˜ å°„è¿‡å»ï¼š`sudo ln -sf /usr/include/boost/endian.hpp /usr/include/boost/detail/endian.hpp`
   - `fatal error: stdlib.h: No such file or directory`ï¼šå’Œä¸Šé¢ç±»ä¼¼ï¼Œæ‰¾åˆ° `stdlib.h`ï¼ŒåŠ å…¥ï¼š`CPLUS_INCLUDE_PATH="$CPLUS_INCLUDE_PATH:/usr/include/c++/11/"`
   - ä»ç„¶ä½¿ç”¨ `boost` ç¼–è¯‘æ—¶å§‹ç»ˆçˆ†å‡º `libboost_python310.so.1.74.0 (3.10, Boost_PYTHON_VERSION=3.8)` çš„é”™è¯¯ï¼Œåæ¥åˆå°è¯•ä¸‹è½½ `boost` æ‰‹å·¥ç¼–è¯‘ `python 3.8` çš„ç‰ˆæœ¬ï¼Œä½†ä»ç„¶æŠ¥é”™ï¼Œæœ€ååªå¥½æ”¾å¼ƒã€‚

**Dockerå®‰è£…Kalibrï¼ˆæˆåŠŸï¼‰**ï¼šæ³¨æ„ Docker å®‰è£…çš„ä»…ä»…æ˜¯ Kalibrï¼Œè¿˜æ˜¯éœ€è¦åˆ©ç”¨å®¿ä¸»æœºä¸Šå®‰è£…çš„ ROS1 å¯¹ç›¸æœºæ•°æ®è¿›è¡Œè·å–ã€‚

1. å®‰è£… ROS1ï¼šå‚è€ƒ[BiliBili - Ubuntu 22.04 apt å®‰è£… ros1 ros Noetic Ninjemys](https://www.bilibili.com/read/cv30135783/)

2. å®‰è£… Dockerï¼šå‚è€ƒ[è…¾è®¯äº‘ - æœ€è¯¦ç»†çš„ubuntuå®‰è£…dockeræ•™ç¨‹](https://cloud.tencent.com/developer/article/2309562)ï¼Œä¸€å®šè¦è®°å¾—**é…ç½®ç”¨æˆ·ç»„**ï¼Œä¸ç„¶æ¯æ¬¡ä½¿ç”¨æ—¶å€™å‰é¢éƒ½åŠ ä¸ª `sudo`ã€‚

3. æ›´æ–° Docker é•œåƒç«™ä¸ DNS åœ°å€ï¼šå‚è€ƒ[CSDN - Dockeræ‹‰å–é•œåƒè¿‡æ…¢æˆ–å¡æ­»çš„å‘ï¼ï¼ï¼ï¼ˆäº²æµ‹æœ‰æ•ˆï¼‰](https://blog.csdn.net/m0_65933139/article/details/130181525)ï¼Œæºåªéœ€è¦ä¸€ä¸ªå³å¯ï¼Œæˆ‘ç”¨çš„æ˜¯ `https://ustc-edu-cn.mirror.aliyuncs.com`ï¼Œ**DNS ä¸€å®šè¦æ£€æŸ¥ä¸‹æ˜¯å¦è¢«ä¿®æ”¹**è¿‡ã€‚

4. Docker-Kalibr å®‰è£…ï¼šå‚è€ƒ[å®˜æ–¹æ•™ç¨‹ - Using the Docker Images](https://github.com/ethz-asl/kalibr/wiki/installation#using-the-docker-images)ï¼Œå¯è§†åŒ–[CSDN - å¦‚ä½•å¯è§†åŒ–dockerï¼šä»¥ROSç¯å¢ƒä¸ºä¾‹ï¼ˆä¾‹å¦‚Gazeboï¼ŒRvizï¼‰](https://blog.csdn.net/zkk9527/article/details/121159353)ï¼Œ

   ```bash
   FOLDER=/home/wty/Programs/kalibr/data  # æœ¬åœ°æ•°æ®ä¿å­˜è·¯å¾„ï¼ˆ**ä¿®æ”¹æˆä½ çš„å“ˆ**ï¼‰
   xhost +local:root  # ä¿®æ”¹X11æ¸²æŸ“ä¸»æœºæƒé™ä¸ºrootï¼Œç”¨äºå¯è§†åŒ–ROSå›¾åƒ
   docker run -it \  # å¯åŠ¨äº¤äº’çª—å£ 
   	--privileged \  # è·å–å®¿ä¸»æœºçš„ç®¡ç†å‘˜æƒé™ï¼Œä»è€Œå¯ä»¥è·å–å¤–éƒ¨è®¾å¤‡ä¿¡æ¯
   	--net=host \  # ä½¿ç”¨å®¿ä¸»æœºçš„ç½‘ç»œï¼Œä»è€Œå¯ä»¥é€šè¿‡è®¾ç½®http_proxyå’Œhttps_proxyç›´æ¥ä½¿ç”¨ä»£ç†
   	-e "DISPLAY" -e "QT_X11_NO_MITSHM=1" \  # ä¸€äº›ç”¨äºå¯è§†åŒ–çš„ç¯å¢ƒå˜é‡
   	-v "/dev:/dev" \  # è·å–å®¿ä¸»æœºè®¾å¤‡ä¿¡æ¯ï¼Œä»è€Œå¯ä»¥è¯»å–åˆ°æ‘„åƒå¤´
       -v "/tmp/.X11-unix:/tmp/.X11-unix:rw" \  # X11å¯è§†åŒ–è½¬å‘
       -v "$FOLDER:/data" \  # å°†/dataè½¬å‘åˆ°æœ¬åœ°çš„æ•°æ®ä¿å­˜è·¯å¾„
       kalibr  # å¯åŠ¨çš„é•œåƒåç§°
   # å†™æˆä¸€è¡Œ
   docker run -it --privileged	--net=host -e "DISPLAY" -e "QT_X11_NO_MITSHM=1" -v "/dev:/dev" -v "/tmp/.X11-unix:/tmp/.X11-unix:rw" -v "$FOLDER:/data" kalibr
   ```

5. Docker ç¯å¢ƒå˜é‡åŠ è½½ï¼š

   ```bash
   source devel/setup.bash
   ```

   å¯ä»¥å°†è¿™å¥è¯åŠ åˆ° `~/.bashrc` ä¸­ï¼Œæ³¨æ„æˆ‘ä»¬ä¿®æ”¹äº†å®¹å™¨çš„å†…å®¹åï¼Œéœ€è¦å¯¹é•œåƒä½¿ç”¨ `docker commit kalibr kalibr:v1` æ›´æ–°ï¼Œä¾‹å¦‚è¿™æ ·å°±æ˜¯æ›´æ–°é•œåƒåç§°ä» `kalibr -> kalibr:v1`ï¼Œä¸‹ä¸€æ¬¡æˆ‘ä»¬æ‰“å¼€å®¹å™¨å°±ä»æ–°çš„é•œåƒ `kalibr:v1` ä¸­æ‰“å¼€å³å¯ï¼Œåˆ é™¤å¤šä½™é•œåƒæ–¹æ³•å‚è€ƒ [å¦‚ä½•ä¼˜é›…åœ°åˆ é™¤Dockeré•œåƒå’Œå®¹å™¨ï¼ˆè¶…è¯¦ç»†ï¼‰](https://blog.csdn.net/u014282578/article/details/127866389)ï¼Œç›¸æœºæ ‡å®šæ–‡ä»¶ [ä¸‹è½½é“¾æ¥](https://github.com/ethz-asl/kalibr/issues/514)

6. æˆ‘ä»¬è¿˜éœ€è¦å®‰è£… RealSenseâ„¢ SDK 2.0ï¼Œé¡ºç€[å®˜æ–¹æ•™ç¨‹ - Linux Distribution](https://github.com/IntelRealSense/librealsense/blob/master/doc/distribution_linux.md#installing-the-packages)å®‰è£…å®Œæˆ `librealsense2-dkms, librealsense2-utils`ï¼Œå†è¿æ¥æ‘„åƒå¤´ï¼Œè¿è¡Œå‘½ä»¤ `realsense-viewer` çœ‹æ˜¯å¦å¯ä»¥å‡ºç°å¦‚ä¸‹å¯è§†åŒ–ç•Œé¢ï¼Œè¯´æ˜å®‰è£…æˆåŠŸï¼ˆè®°å¾—æŠŠå·¦è¾¹çš„æ‘„åƒå¤´åŠŸèƒ½å¼€å…³æ‰“å¼€ï¼‰ï¼š

<div align='center'>
   <img src=./assets/figures/realsense_viewer1.png width=49%></image>
   <img src=./assets/figures/realsense_viewer2.png width=49%></image>
</div>
   


#### å†…å‚çŸ©é˜µè·å–

 åœ¨ ROS ä¸­å°†æ‘„åƒå¤´åŠ å…¥è¯é¢˜ï¼ˆROS æ˜¯ä¸€ä¸ªæ§åˆ¶ç³»ç»Ÿï¼Œéœ€è¦å°†æ¯ä¸ªè®¾å¤‡æ‰‹åŠ¨æ‰“å¼€ï¼Œæ‰“å¼€åæˆä¸ºä¸€ä¸ª nodeï¼Œä½¿ç”¨ `rosnode list` æŸ¥çœ‹ï¼Œæ¯ä¸ª node è¿˜å…·æœ‰å¾ˆå¤šç›¸å…³ topicï¼Œå¯ä»¥è·å–å…¶å‚æ•°ä¿¡æ¯ï¼Œé€šè¿‡ `rostopic list` æŸ¥çœ‹å…¨éƒ¨ topicï¼Œä½¿ç”¨ `rostopic echo ${topic-name}` è·å–è¯é¢˜å…·ä½“ä¿¡æ¯ï¼Œè€Œæ‰“å¼€ D435 æ‘„åƒå¤´å°±éœ€è¦ä½¿ç”¨ realsense å®‰è£…çš„ç›¸å…³ä¾èµ–åŒ…ï¼‰ï¼Œ **å†…å‚è·å–**æ–¹æ³•å¦‚ä¸‹ï¼š

æ‰§è¡Œ `roslaunch realsense2_camera rs_camera.launch` å°†æ‘„åƒå¤´åŠ å…¥åˆ° nodeï¼Œæ‰§è¡Œ `rostopic list` æŸ¥çœ‹ï¼ˆå·¦å›¾ï¼‰ï¼Œå¹¶ä½¿ç”¨ `rostopic echo /camera/color/camera_info` ï¼ˆå³å›¾ï¼‰ï¼š

![ROS+RealSenseè·å–ç›¸æœºå†…å‚çŸ©é˜µ](./assets/figures/ROS+RealSenseè·å–ç›¸æœºå†…å‚çŸ©é˜µ.png)

å†…å‚çŸ©é˜µä¸º `K: [908.2644653320312, 0.0, 650.677978515625, 0.0, 907.4638671875, 370.1951904296875, 0.0, 0.0, 1.0]` å¯¹åº” $3\times 3$ çŸ©é˜µçš„å±•å¼€ï¼ˆå’Œä¸Šæ–‡ROS2è·å–ä¸­çš„å†…å‚çŸ©é˜µä¸åŒæ˜¯å› ä¸ºæ¢äº†ä¸ªç›¸æœºï¼‰

#### ç•¸å˜çŸ©é˜µæ ‡å®š

>  å‚è€ƒ Kalibr [å®˜æ–¹æ•™ç¨‹](https://github.com/ethz-asl/kalibr/wiki/multiple-camera-calibration) å’Œ [CSDN - Intel Realsense D435iæ ‡å®šè¯¦ç»†æ­¥éª¤](https://blog.csdn.net/weixin_42705114/article/details/109721864)

##### æ˜¾ç¤ºå½“å‰æ‘„åƒå¤´

é¦–å…ˆè¦å­¦ä¼šé€šè¿‡ `rviz` æ˜¾ç¤ºå½“å‰æ‘„åƒå¤´ï¼Œé¦–å…ˆæˆ‘ä»¬è¿˜æ˜¯æ‰“å¼€ç›¸æœºèŠ‚ç‚¹ `roslaunch realsense2_camera rs_camera.launch`ï¼Œæ‰“å¼€ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼ˆå¯ä»¥ä½¿ç”¨ `tmux` æˆ–è€…ç”¨ `vscode` æ‰“å¼€ dockerï¼‰ï¼Œæ‰§è¡Œ `rviz`ï¼Œä¼šå¼¹å‡ºå¯è§†åŒ–ç•Œé¢ï¼Œå¦‚ä¸‹æ“ä½œä» `Add -> By topic -> /camera/color/image_raw/image -> OK` ä¸­ï¼Œå³å¯åŠ å…¥å½“å‰ç›¸æœºå›¾åƒï¼ˆè¦ä»è¾¹ä¸Šæ‹–å‡ºæ¥æ‰èƒ½æ”¾å¤§ï¼‰ã€‚

<div align='center'>
    <image src=./assets/figures/rvizåŠ å…¥æŒ‰é’®.png width=39%></image>
    <image src=./assets/figures/rvizåŠ å…¥èŠ‚ç‚¹.png width=19%></image>
    <image src=./assets/figures/rvizåŠ å…¥å›¾åƒç»“æœ.png width=39%></image>
<div/>

##### è·å–æ ‡å®šæ¿

æ ‡å®šé¦–å…ˆéœ€è¦å…ˆæ‰“å°å‡ºæ¥ä¸€ä¸ªæ ‡å®šæ¿ï¼Œæ ‡å®šç‰ˆé…ç½®å¯ä»¥å‚è€ƒå®˜æ–¹çš„é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬åœ¨å…±äº«è·¯å¾„åˆ›å»ºé…ç½®æ–‡ä»¶å¦‚ä¸‹ï¼š

```bash
â¯ cat /data/april_6x6.yaml
target_type: 'aprilgrid' #gridtype
tagCols: 6                  #number of apriltags
tagRows: 6                  #number of apriltags
tagSize: 0.088              #size of apriltag, edge to edge [m]
tagSpacing: 0.3             #ratio of space between tags to tagSize
```

å¯¹åº”ç”Ÿæˆæ ‡è®°æ¿ `pdf` æ–‡ä»¶å‘½ä»¤ä¸º

```bash
kalibr_create_target_pdf --type apriltag --nx 6 --ny 6 --tsize 0.088 --tspace 0.3 /data/target.pdf
```

æˆ‘ä»¬å°±èƒ½åœ¨æœ¬æœºçš„å…±äº«ç›®å½• `$FOLDER` ä¸‹çœ‹åˆ°æ ‡å®šiæ¿ [`target.pdf`](assets/figures/target.pdf) æ–‡ä»¶ï¼Œä»è€Œè¿›è¡Œæ‰“å°ã€‚

##### å½•åˆ¶ROSè§†é¢‘åŒ…

æ ‡å®šæ˜¯ç¦»çº¿è¿›è¡Œçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å…ˆå½•åˆ¶ä¸€ä¸ªè§†é¢‘åŒ…ä¸‹æ¥ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸ç”¨åœ¨ç›¸æœºåŸæœ‰çš„é¢‘ç‡ä¸‹æ ‡è®°ï¼Œæ‰€ä»¥åˆ›å»ºä¸€ä¸ªå›ºå®š 10Hz é¢‘ç‡ï¼ˆéšä¾¿ç»™ä¸ªä½ç‚¹çš„å°±è¡Œï¼‰çš„æ–°èŠ‚ç‚¹ `\color`ï¼š`rosrun topic_tools throttle messages /camera/color/image_raw 10.0 /color`ï¼Œç„¶åæˆ‘ä»¬å†ä»ä¸Šé¢çš„ `rviz` ä¸­æ‰“å¼€ `/color` èŠ‚ç‚¹çš„å›¾åƒï¼Œå¯ä»¥çœ‹åˆ°æœ‰æ˜æ˜¾æ‰å¸§ï¼Œæˆ‘ä»¬æ‹¿èµ·æ ‡å®šæ¿ä¿æŒåœ¨æ‘„åƒå¤´ä¸­ï¼Œå¼€å§‹è§†é¢‘å½•åˆ¶ `rosbag record -O /data/camd435i_10hz /color`ï¼Œåœ¨å½•åˆ¶è¿‡ç¨‹ä¸­å¯ä»¥å·¦å³ç§»åŠ¨ä¸‹æ ‡è®°æ¿ï¼Œç„¶å `ctrl C` åœæ­¢å½•åˆ¶ï¼Œæ–‡ä»¶ä¿å­˜åœ¨ `/data/camd435i_10hz.bag` ä¸­ã€‚

##### å…§å‚æ•°åŠç•¸å˜çŸ©é˜µè®¡ç®—

å¦‚æœ `kalibr_calibrate_cameras` æ— æ³•æ‰§è¡Œï¼Œæ·»åŠ è·¯å¾„ï¼š`export PATH=/catkin_ws/devel/lib/kalibr:$PATH` ã€‚

æ‰§è¡Œä¸‹è¿°ä»£ç ï¼ˆ[å¯è§†åŒ–è§’ç‚¹æ£€æµ‹æ•ˆæœ Kalibræ ‡è®°æ•ˆæœ.webm](https://drive.google.com/file/d/19TT175ZED-C_JfZUa_B8XhbsDBknxlpf/view?usp=drive_link)ï¼‰

````bash
kalibr_calibrate_cameras --target /data/april_6x6.yaml \  # æ ‡è®°æ¿é…ç½®æ–‡ä»¶
	--bag /data/camd435i_10hz.bag \  # å½•åˆ¶çš„è§†é¢‘åŒ…
	--models pinhole-radtan \  # é€‰æ‹©çš„ç›¸æœºæ¨¡å‹ä¸ºpinholeï¼Œç•¸å˜æ¨¡å‹ä¸ºradtan
	--topics /color \  # é€‰æ‹©å½•åˆ¶è§†é¢‘çš„è¯é¢˜
	--show-extractio  # å¯è§†åŒ–è§’ç‚¹æ£€æµ‹ç»“æœ
# å†™æˆä¸€è¡Œ
kalibr_calibrate_cameras --target /data/april_6x6.yaml --bag /data/camd435i_10hz.bag --models pinhole-radtan --topics /color --show-extractio
````

ç­‰æ‰§è¡Œå®Œæˆåï¼Œåœ¨ `/data` æ–‡ä»¶å¤¹ï¼ˆå…±äº«æ–‡ä»¶å¤¹ï¼‰ä¸‹ä¼šç”Ÿæˆä¸‰ä¸ªæ–‡ä»¶ `*.pdf, *.txt, *.yaml`ï¼Œæˆ‘çš„ `*.txt` æ–‡ä»¶å¦‚ä¸‹ï¼š

```txt
Calibration results 
====================
Camera-system parameters:
cam0 (/color):
    type: <class 'aslam_cv.libaslam_cv_python.DistortedPinholeCameraGeometry'>
    distortion: [ 0.1136323  -0.24918569 -0.00006587  0.00135696] +- [0.00317183 0.00929075 0.00046802 0.00045858]
    projection: [900.87667006 900.02687406 652.03098026 367.2331528 ] +- [0.92552758 0.81790359 1.04089438 1.11924883]
    reprojection error: [0.000000, 0.000000] +- [0.268245, 0.238228]



Target configuration
====================

  Type: aprilgrid
  Tags: 
    Rows: 6
    Cols: 6
    Size: 0.088 [m]
    Spacing 0.026399999999999996 [m]
```

å¯ä»¥çœ‹å‡ºç•¸å˜å‚æ•°ä¸º `[ 0.1136323  -0.24918569 -0.00006587  0.00135696]`ï¼Œå…¶ä¸­å‰ä¸¤ä¸ªä¸ºå¾„å‘ç•¸å˜ï¼Œåä¸¤ä¸ªä¸ºåˆ‡å‘ç•¸å˜ã€‚å¯¹äºå†…å‚çŸ©é˜µï¼Œå’Œ ROS+RealSense ç›´æ¥è¯»å–å‡ºæ¥çš„æ¯”è¾ƒæ¥è¿‘ï¼Œä½†æ²¡æœ‰é‚£ä¸ªç²¾ç¡®ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨ç›´æ¥è¯»å–å‡ºæ¥çš„ç”¨äºåç»­è®¡ç®—ã€‚
